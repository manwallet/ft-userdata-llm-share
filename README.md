# Freqtrade LLM Function Calling Strategy

> åŸºäºå¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰Function Calling å’Œ RAG æŠ€æœ¯çš„æ™ºèƒ½åŠ å¯†è´§å¸äº¤æ˜“ç­–ç•¥

[![Freqtrade](https://img.shields.io/badge/freqtrade-stable-blue)](https://www.freqtrade.io/)
[![Python](https://img.shields.io/badge/python-3.11+-blue.svg)](https://www.python.org/)
[![License](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)

---

## ğŸ” é‡è¦å®‰å…¨æç¤º

**åœ¨ä½¿ç”¨æœ¬é¡¹ç›®å‰ï¼Œè¯·åŠ¡å¿…é…ç½®æ‚¨çš„æ•æ„Ÿä¿¡æ¯ï¼**

æœ¬ä»£ç åº“ä¸­çš„é…ç½®æ–‡ä»¶ï¼ˆ`user_data/config.json`ï¼‰å·²ç»è¿‡è„±æ•å¤„ç†ï¼Œæ‰€æœ‰ API å¯†é’¥ã€äº¤æ˜“æ‰€å¯†é’¥ç­‰æ•æ„Ÿä¿¡æ¯å‡å·²æ¸…ç©ºã€‚åœ¨è¿è¡Œé¡¹ç›®å‰ï¼Œæ‚¨éœ€è¦ï¼š

1. **å¡«å†™æ‚¨çš„ LLM API å¯†é’¥**ï¼šåœ¨ `user_data/config.json` çš„ `llm_config` éƒ¨åˆ†
2. **å¡«å†™äº¤æ˜“æ‰€ API å¯†é’¥**ï¼šåœ¨ `user_data/config.json` çš„ `exchange` éƒ¨åˆ†
3. **é…ç½®å…¶ä»–æœåŠ¡**ï¼šTelegramã€Discordã€JWT ç­‰ï¼ˆå¯é€‰ï¼‰

è¯¦ç»†é…ç½®è¯´æ˜è¯·å‚è€ƒï¼š[CONFIG_TEMPLATE.md](CONFIG_TEMPLATE.md)

**å®‰å…¨å»ºè®®**ï¼š
- âœ… ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼ˆå‚è€ƒ `.env.example`ï¼‰
- âœ… ä¸è¦å°†åŒ…å«çœŸå®å¯†é’¥çš„é…ç½®æ–‡ä»¶æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
- âœ… å»ºè®®å…ˆä½¿ç”¨ `dry_run: true` æ¨¡å¼æµ‹è¯•
- âœ… é™åˆ¶äº¤æ˜“æ‰€ API æƒé™ï¼ˆä¸å¼€å¯æç°æƒé™ï¼‰

---

## ğŸ“‹ ç›®å½•

- [ğŸ” é‡è¦å®‰å…¨æç¤º](#-é‡è¦å®‰å…¨æç¤º)
- [ğŸ¯ é¡¹ç›®ç®€ä»‹](#-é¡¹ç›®ç®€ä»‹)
- [âœ¨ æ ¸å¿ƒç‰¹æ€§](#-æ ¸å¿ƒç‰¹æ€§)
- [ğŸ—ï¸ ç³»ç»Ÿæ¶æ„](#ï¸-ç³»ç»Ÿæ¶æ„)
- [ğŸš€ å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹)
- [ğŸ’¡ å¸¸è§ä½¿ç”¨åœºæ™¯](#-å¸¸è§ä½¿ç”¨åœºæ™¯)
- [âš™ï¸ é…ç½®è¯´æ˜](#ï¸-é…ç½®è¯´æ˜)
- [ğŸ“– ä½¿ç”¨æŒ‡å—](#-ä½¿ç”¨æŒ‡å—)
- [ğŸ“Š æ€§èƒ½ç›‘æ§](#-æ€§èƒ½ç›‘æ§)
- [ğŸ”§ æ•…éšœæ’é™¤](#-æ•…éšœæ’é™¤)
- [ğŸ”¬ æŠ€æœ¯ç»†èŠ‚](#-æŠ€æœ¯ç»†èŠ‚)
- [âš ï¸ é£é™©æç¤º](#ï¸-é£é™©æç¤º)

---

## ğŸ¯ é¡¹ç›®ç®€ä»‹

è¿™æ˜¯ä¸€ä¸ªåˆ›æ–°çš„åŠ å¯†è´§å¸è‡ªåŠ¨åŒ–äº¤æ˜“ç­–ç•¥ï¼Œå°† **Freqtrade** äº¤æ˜“æ¡†æ¶ä¸ **å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰** æ·±åº¦æ•´åˆï¼Œé€šè¿‡ OpenAI Function Calling å’Œ RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰æŠ€æœ¯å®ç°æ™ºèƒ½äº¤æ˜“å†³ç­–ã€‚

### ä¸ºä»€ä¹ˆé€‰æ‹© LLM ç­–ç•¥ï¼Ÿ

- **ğŸ§  æ™ºèƒ½å†³ç­–**: LLM å¯ä»¥ç†è§£å¤æ‚çš„å¸‚åœºæƒ…å†µï¼Œæä¾›ç±»äººçš„äº¤æ˜“åˆ¤æ–­
- **ğŸ“š ç»éªŒå­¦ä¹ **: RAG ç³»ç»Ÿä»å†å²äº¤æ˜“ä¸­å­¦ä¹ ï¼Œä¸æ–­ä¼˜åŒ–å†³ç­–è´¨é‡
- **ğŸ¯ ç²¾å‡†æ§åˆ¶**: Function Calling æä¾› 6 ä¸ªæ ¸å¿ƒäº¤æ˜“å‡½æ•°ï¼Œå®ç°ç²¾ç»†åŒ–äº¤æ˜“ç®¡ç†
- **ğŸ“Š å¤šç»´åº¦åˆ†æ**: ç»¼åˆæŠ€æœ¯æŒ‡æ ‡ã€è´¦æˆ·çŠ¶æ€ã€æŒä»“æƒ…å†µè¿›è¡Œå…¨å±€å†³ç­–

---

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### 1. **OpenAI Function Calling å®Œæ•´äº¤æ˜“æ§åˆ¶**

LLM é€šè¿‡ 6 ä¸ªæ ¸å¿ƒå‡½æ•°å®Œå…¨æ§åˆ¶äº¤æ˜“æµç¨‹ï¼š

| å‡½æ•°åç§° | åŠŸèƒ½æè¿° | ä¸»è¦å‚æ•° |
|---------|---------|---------|
| `signal_entry_long` | å¼€å¤šä»“ | æŒ‚å•ä»·ã€æ æ†ã€æ­¢æŸã€ç½®ä¿¡åº¦ã€å…³é”®ä½ |
| `signal_entry_short` | å¼€ç©ºä»“ | æŒ‚å•ä»·ã€æ æ†ã€æ­¢æŸã€ç½®ä¿¡åº¦ã€å…³é”®ä½ |
| `signal_exit` | å¹³ä»“ | æŒ‚å•ä»·ã€ç½®ä¿¡åº¦ã€RSI |
| `adjust_position` | åŠ ä»“/å‡ä»“ | è°ƒæ•´ç™¾åˆ†æ¯”ã€æŒ‚å•ä»·ã€å…³é”®ä½ |
| `signal_hold` | ä¿æŒæŒä»“ | ç½®ä¿¡åº¦ã€ç†ç”± |
| `signal_wait` | ç©ºä»“è§‚æœ› | ç½®ä¿¡åº¦ã€ç†ç”± |

### 2. **RAG è¯­ä¹‰æ£€ç´¢ç³»ç»Ÿ**

- **å‘é‡æ•°æ®åº“**: ChromaDB
- **åµŒå…¥æ¨¡å‹**: text-embedding-bge-m3
- **åŠŸèƒ½**:
  - æ£€ç´¢ç›¸ä¼¼çš„å†å²äº¤æ˜“æƒ…å†µ
  - ä»è¿‡å¾€æˆåŠŸ/å¤±è´¥æ¡ˆä¾‹ä¸­å­¦ä¹ 
  - æä¾›ä¸Šä¸‹æ–‡ç›¸å…³çš„äº¤æ˜“å»ºè®®

### 3. **æœŸè´§äº¤æ˜“å®Œæ•´æ”¯æŒ**

- âœ… å¤šç©ºåŒå‘äº¤æ˜“ï¼ˆåšå¤š/åšç©ºï¼‰
- âœ… åŠ¨æ€æ æ†ï¼ˆ1-100xï¼Œç”± LLM å†³å®šï¼‰
- âœ… åŠ¨æ€æ­¢æŸï¼ˆåŸºäºè´¦æˆ·ç™¾åˆ†æ¯”ï¼‰
- âœ… ä»“ä½è°ƒæ•´ï¼ˆåŠ ä»“/å‡ä»“ï¼‰
- âœ… æŒ‚å•ä»·æ ¼æ§åˆ¶ï¼ˆå…¥åœº/å‡ºåœºç²¾ç¡®å®šä»·ï¼‰

### 4. **å¤šæ—¶é—´æ¡†æ¶æŠ€æœ¯åˆ†æ**

æ”¯æŒ 4 ä¸ªæ—¶é—´æ¡†æ¶åŒæ—¶åˆ†æï¼š
- **15åˆ†é’Ÿ**ï¼ˆä¸»æ—¶é—´æ¡†æ¶ï¼‰
- **1å°æ—¶**
- **4å°æ—¶**
- **æ—¥çº¿**

æŠ€æœ¯æŒ‡æ ‡åŒ…æ‹¬ï¼š
- è¶‹åŠ¿ï¼šEMA(20/50/200)
- åŠ¨é‡ï¼šRSIã€MACD
- æ³¢åŠ¨ï¼šå¸ƒæ—å¸¦ã€ATR
- å¼ºåº¦ï¼šADXã€MFIã€OBV

### 5. **ç»éªŒå­¦ä¹ ä¸å†³ç­–è®°å½•**

- ğŸ“ æ¯ç¬”äº¤æ˜“å†³ç­–è‡ªåŠ¨è®°å½•
- ğŸ” åŒ…å«å¸‚åœºä¸Šä¸‹æ–‡ã€æŠ€æœ¯æŒ‡æ ‡ã€æ¨ç†è¿‡ç¨‹
- ğŸ“Š æ”¯æŒäº‹ååˆ†æå’Œç­–ç•¥ä¼˜åŒ–
- ğŸ“ RAG ç³»ç»ŸæŒç»­ä»å†å²ä¸­å­¦ä¹ 

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
ft-userdata-llm/
â”œâ”€â”€ docker-compose.yml          # Docker ç¼–æ’é…ç½®
â”œâ”€â”€ Dockerfile.custom           # è‡ªå®šä¹‰é•œåƒï¼ˆå®‰è£… ChromaDBï¼‰
â”œâ”€â”€ manage.sh                   # ä¸€é”®ç®¡ç†è„šæœ¬
â”‚
â””â”€â”€ user_data/
    â”œâ”€â”€ config.json             # æ ¸å¿ƒé…ç½®æ–‡ä»¶
    â”‚
    â”œâ”€â”€ strategies/
    â”‚   â”œâ”€â”€ LLMFunctionStrategy.py    # ä¸»ç­–ç•¥æ–‡ä»¶
    â”‚   â”‚
    â”‚   â””â”€â”€ llm_modules/              # LLM æ¨¡å—
    â”‚       â”œâ”€â”€ llm/                  # LLM å®¢æˆ·ç«¯
    â”‚       â”‚   â”œâ”€â”€ llm_client.py         # OpenAI API å°è£…
    â”‚       â”‚   â””â”€â”€ function_executor.py  # Function Calling æ‰§è¡Œå™¨
    â”‚       â”‚
    â”‚       â”œâ”€â”€ rag/                  # RAG ç³»ç»Ÿ
    â”‚       â”‚   â”œâ”€â”€ embedding_service.py  # åµŒå…¥æœåŠ¡
    â”‚       â”‚   â”œâ”€â”€ vector_store.py       # ChromaDB å°è£…
    â”‚       â”‚   â””â”€â”€ rag_manager.py        # RAG ç®¡ç†å™¨
    â”‚       â”‚
    â”‚       â”œâ”€â”€ tools/                # äº¤æ˜“å·¥å…·
    â”‚       â”‚   â””â”€â”€ trading_tools.py      # 6ä¸ªæ ¸å¿ƒäº¤æ˜“å‡½æ•°
    â”‚       â”‚
    â”‚       â”œâ”€â”€ experience/           # ç»éªŒç³»ç»Ÿ
    â”‚       â”‚   â”œâ”€â”€ trade_logger.py       # äº¤æ˜“æ—¥å¿—
    â”‚       â”‚   â””â”€â”€ experience_manager.py # ç»éªŒç®¡ç†
    â”‚       â”‚
    â”‚       â””â”€â”€ utils/                # å·¥å…·ç±»
    â”‚           â”œâ”€â”€ config_loader.py      # é…ç½®åŠ è½½
    â”‚           â””â”€â”€ context_builder.py    # ä¸Šä¸‹æ–‡æ„å»º
    â”‚
    â”œâ”€â”€ data/
    â”‚   â””â”€â”€ vector_store/         # ChromaDB å‘é‡æ•°æ®åº“
    â”‚
    â””â”€â”€ logs/
        â”œâ”€â”€ freqtrade.log         # ä¸»æ—¥å¿—
        â”œâ”€â”€ llm_decisions.jsonl   # LLM å†³ç­–æ—¥å¿—
        â””â”€â”€ trade_experience.jsonl # äº¤æ˜“ç»éªŒæ—¥å¿—
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- **Docker** å’Œ **Docker Compose** å·²å®‰è£…
- **LLM API**: æ”¯æŒ OpenAI Function Calling çš„ APIï¼ˆå¦‚ OpenAIã€OneAPIã€æœ¬åœ° LLMï¼‰
- **å¸å®‰è´¦æˆ·**ï¼ˆæˆ–å…¶ä»–æ”¯æŒçš„äº¤æ˜“æ‰€ï¼‰

### 1. é…ç½® LLM API

ç¼–è¾‘ `user_data/config.json`ï¼š

```json
"llm_config": {
    "api_base": "http://host.docker.internal:3120",
    "api_key": "your-api-key",
    "model": "qwen/qwen3-coder-30b",
    "embedding_model": "text-embedding-bge-m3",
    "temperature": 0.7,
    "max_tokens": 2000,
    "timeout": 60
}
```

**æ”¯æŒçš„ LLM æä¾›å•†**:
- OpenAI GPT-4
- OneAPI (å…¼å®¹ OpenAI æ ¼å¼)
- Qwen3 Coder
- DeepSeek
- å…¶ä»–å…¼å®¹ OpenAI Function Calling çš„æ¨¡å‹

### 2. é…ç½®äº¤æ˜“æ‰€

ç¼–è¾‘ `user_data/config.json` ä¸­çš„äº¤æ˜“æ‰€é…ç½®ï¼š

```json
"exchange": {
    "name": "binance",
    "key": "your-api-key",
    "secret": "your-api-secret",
    "ccxt_config": {
        "enableRateLimit": true,
        "options": {
            "defaultType": "future"
        }
    }
}
```

### 3. å¯åŠ¨ç­–ç•¥

#### æ–¹å¼ä¸€ï¼šä½¿ç”¨ç®¡ç†è„šæœ¬ï¼ˆæ¨èï¼‰

**ä¸€é”®ç®¡ç†è„šæœ¬ `manage.sh` æä¾›å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†**

```bash
# é¦–æ¬¡ä½¿ç”¨ï¼šèµ‹äºˆæ‰§è¡Œæƒé™
chmod +x manage.sh

# å‘½ä»¤è¡Œæ¨¡å¼ï¼ˆå¿«é€Ÿæ“ä½œï¼‰
./manage.sh start    # å¿«é€Ÿå¯åŠ¨ âš¡ï¼ˆæ¨èæ—¥å¸¸ä½¿ç”¨ï¼‰
./manage.sh logs     # æŸ¥çœ‹å®æ—¶æ—¥å¿—
./manage.sh restart  # é‡å¯æœåŠ¡
./manage.sh stop     # åœæ­¢æœåŠ¡
./manage.sh deploy   # å®Œæ•´éƒ¨ç½²ï¼ˆæ£€æŸ¥æ›´æ–°+é‡æ–°æ„å»ºï¼‰
./manage.sh clean    # æ¸…ç†æ‰€æœ‰æ•°æ®ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰

# äº¤äº’å¼èœå•æ¨¡å¼
./manage.sh          # ä¸å¸¦å‚æ•°ï¼Œæ˜¾ç¤ºäº¤äº’å¼èœå•
```

**manage.sh åŠŸèƒ½è¯¦è§£**:

| å‘½ä»¤ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|------|------|---------|
| `start` | å¿«é€Ÿå¯åŠ¨ + è‡ªåŠ¨æŸ¥çœ‹æ—¥å¿— | âš¡ æ—¥å¸¸å¯åŠ¨ï¼ˆæœ€å¸¸ç”¨ï¼‰ |
| `restart` | é‡å¯å®¹å™¨ + æŸ¥çœ‹æ—¥å¿— | ä¿®æ”¹é…ç½®åé‡å¯ |
| `deploy` | æ£€æŸ¥ç‰ˆæœ¬ + æ„å»ºé•œåƒ + å¯åŠ¨ | é¦–æ¬¡éƒ¨ç½²æˆ–å¤§ç‰ˆæœ¬æ›´æ–° |
| `logs` | åªæŸ¥çœ‹å®æ—¶æ—¥å¿— | ç›‘æ§è¿è¡ŒçŠ¶æ€ |
| `stop` | åœæ­¢æœåŠ¡ | æš‚åœäº¤æ˜“ |
| `clean` | æ¸…ç†æ‰€æœ‰æ•°æ® | é‡ç½®ç³»ç»Ÿï¼ˆä¼šåˆ é™¤å†å²æ•°æ®ï¼‰ |

**äº¤äº’å¼èœå•ï¼ˆè¿è¡Œ `./manage.sh`ï¼‰**:
```
  Freqtrade LLM Strategy ç®¡ç†å·¥å…·
=================================================

  1) å¿«é€Ÿå¯åŠ¨ (ç›´æ¥å¯åŠ¨ + æŸ¥çœ‹æ—¥å¿—) âš¡
  2) å¿«é€Ÿé‡å¯ (é‡å¯å®¹å™¨ + æŸ¥çœ‹æ—¥å¿—)
  3) å®Œæ•´éƒ¨ç½² (æ£€æŸ¥ç‰ˆæœ¬ + æ„å»º + å¯åŠ¨)
  4) åªæŸ¥çœ‹æ—¥å¿—
  5) æ¸…ç†æ‰€æœ‰æ•°æ®
  6) æ£€æŸ¥ç‰ˆæœ¬
  7) åœæ­¢æœåŠ¡
  0) é€€å‡º
```

#### æ–¹å¼äºŒï¼šç›´æ¥ä½¿ç”¨ Docker Compose

```bash
# æ„å»ºé•œåƒï¼ˆé¦–æ¬¡æˆ–æ›´æ–°æ—¶ï¼‰
docker-compose build

# å¯åŠ¨æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker logs -f freqtrade-llm

# åœæ­¢æœåŠ¡
docker-compose down

# é‡å¯æœåŠ¡
docker-compose restart
```

#### é¦–æ¬¡å¯åŠ¨æµç¨‹ç¤ºä¾‹

```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/your-username/freqtrade-llm-strategy.git
cd freqtrade-llm-strategy

# 2. é…ç½® API å¯†é’¥ï¼ˆé‡è¦ï¼ï¼‰
nano user_data/config.json  # å¡«å†™ llm_config å’Œ exchange é…ç½®

# 3. èµ‹äºˆè„šæœ¬æ‰§è¡Œæƒé™
chmod +x manage.sh

# 4. é¦–æ¬¡éƒ¨ç½²ï¼ˆä¼šè‡ªåŠ¨æ„å»ºé•œåƒï¼‰
./manage.sh deploy

# 5. è§‚å¯Ÿæ—¥å¿—ï¼Œç¡®è®¤è¿è¡Œæ­£å¸¸
# æŒ‰ Ctrl+C é€€å‡ºæ—¥å¿—æŸ¥çœ‹
```

#### æ—¥å¸¸ä½¿ç”¨æµç¨‹

```bash
# æ¯å¤©å¯åŠ¨
./manage.sh start

# ä¿®æ”¹é…ç½®åé‡å¯
nano user_data/config.json
./manage.sh restart

# æŸ¥çœ‹è¿è¡ŒçŠ¶æ€
./manage.sh logs
```

### 4. ç›‘æ§è¿è¡Œ

- **æ—¥å¿—**: `./manage.sh logs` æˆ– `docker logs -f freqtrade-llm`
- **Web UI**: http://localhost:8086 (ç”¨æˆ·åå¯†ç è§ `config.json`)
- **REST API**: http://localhost:8086/api/v1/

---

## ğŸ’¡ å¸¸è§ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1ï¼šé¦–æ¬¡ä½¿ç”¨ï¼ˆæ¨¡æ‹Ÿäº¤æ˜“æµ‹è¯•ï¼‰

```bash
# 1. é…ç½®æ–‡ä»¶ä¸­ç¡®ä¿å¼€å¯æ¨¡æ‹Ÿæ¨¡å¼
# user_data/config.json ä¸­è®¾ç½®ï¼š
#   "dry_run": true,
#   "dry_run_wallet": 1340

# 2. å¯åŠ¨ç³»ç»Ÿ
./manage.sh deploy

# 3. è§‚å¯Ÿ LLM å†³ç­–æ—¥å¿—
tail -f user_data/logs/llm_decisions.jsonl | jq .

# 4. æŸ¥çœ‹ Web UI çš„æ¨¡æ‹Ÿäº¤æ˜“ç»“æœ
# æ‰“å¼€æµè§ˆå™¨è®¿é—® http://localhost:8086
```

### åœºæ™¯ 2ï¼šä»æ¨¡æ‹Ÿåˆ‡æ¢åˆ°å®ç›˜

```bash
# 1. åœæ­¢æœåŠ¡
./manage.sh stop

# 2. ä¿®æ”¹é…ç½®
nano user_data/config.json
# è®¾ç½® "dry_run": false
# å¡«å†™çœŸå®çš„äº¤æ˜“æ‰€ API å¯†é’¥

# 3. æ¸…ç†æ¨¡æ‹Ÿäº¤æ˜“æ•°æ®ï¼ˆå¯é€‰ï¼‰
./manage.sh clean

# 4. é‡æ–°å¯åŠ¨
./manage.sh deploy

# 5. å¯†åˆ‡ç›‘æ§
./manage.sh logs
```

### åœºæ™¯ 3ï¼šæ›´æ–°é…ç½®åé‡å¯

```bash
# ä¿®æ”¹äº† config.json ä¸­çš„ä»»ä½•é…ç½®
nano user_data/config.json

# å¿«é€Ÿé‡å¯ä½¿é…ç½®ç”Ÿæ•ˆ
./manage.sh restart
```

### åœºæ™¯ 4ï¼šè°ƒè¯• LLM å†³ç­–

```bash
# å®æ—¶æŸ¥çœ‹ LLM çš„æ€è€ƒè¿‡ç¨‹
tail -f user_data/logs/freqtrade.log | grep -i "llm\|function\|å†³ç­–"

# æŸ¥çœ‹æ ¼å¼åŒ–çš„å†³ç­–æ—¥å¿—
tail -f user_data/logs/llm_decisions.jsonl | jq '{
  pair: .pair,
  action: .action,
  confidence: .confidence,
  reason: .reason
}'
```

### åœºæ™¯ 5ï¼šä¼˜åŒ– RAG æ€§èƒ½

```bash
# å¦‚æœå†³ç­–å˜æ…¢ï¼Œæ£€æŸ¥å‘é‡æ•°æ®åº“å¤§å°
du -sh user_data/data/vector_store/

# å¦‚æœæ•°æ®è¿‡å¤šï¼Œå¯ä»¥æ¸…ç†æ—§æ•°æ®
./manage.sh stop

# åªåˆ é™¤å‘é‡æ•°æ®åº“ï¼ˆä¿ç•™äº¤æ˜“è®°å½•ï¼‰
rm -rf user_data/data/vector_store/*

./manage.sh start
```

### åœºæ™¯ 6ï¼šæ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬

```bash
# ä½¿ç”¨ deploy å‘½ä»¤ä¼šè‡ªåŠ¨æ£€æŸ¥æ›´æ–°
./manage.sh deploy

# æˆ–è€…æ‰‹åŠ¨æ‹‰å–æœ€æ–°é•œåƒ
docker pull freqtradeorg/freqtrade:stable
./manage.sh deploy
```

---

## âš™ï¸ é…ç½®è¯´æ˜

### é…ç½®æ–‡ä»¶ä½ç½®

æ‰€æœ‰é…ç½®éƒ½åœ¨ `user_data/config.json` æ–‡ä»¶ä¸­ï¼Œè¿™æ˜¯ Freqtrade çš„æ ‡å‡†é…ç½®æ ¼å¼ã€‚

ğŸ’¡ **æç¤º**:
- é¦–æ¬¡ä½¿ç”¨è¯·å‚è€ƒ [CONFIG_TEMPLATE.md](CONFIG_TEMPLATE.md) å®Œæˆé…ç½®
- ä¿®æ”¹é…ç½®åéœ€è¦é‡å¯æœåŠ¡ï¼š`./manage.sh restart`
- å¯ä»¥ä½¿ç”¨ `.env` æ–‡ä»¶ç®¡ç†æ•æ„Ÿä¿¡æ¯ï¼ˆå‚è€ƒ `.env.example`ï¼‰

---

### æ ¸å¿ƒé…ç½®é¡¹

#### 1. **äº¤æ˜“é…ç½®**

```json
{
    "max_open_trades": 4,              // æœ€å¤§æŒä»“æ•°ï¼ˆå»ºè®®ï¼š2-5ï¼‰
    "stake_currency": "USDT",          // äº¤æ˜“å¸ç§
    "stake_amount": "unlimited",       // ä»“ä½å¤§å°ï¼ˆunlimited=åŠ¨æ€åˆ†é…ï¼‰
    "tradable_balance_ratio": 0.99,    // å¯ç”¨èµ„é‡‘æ¯”ä¾‹ï¼ˆä¿ç•™1%ç¼“å†²ï¼‰
    "trading_mode": "futures",         // äº¤æ˜“æ¨¡å¼ï¼šfutures/spot
    "margin_mode": "isolated",         // ä¿è¯é‡‘ï¼šisolated/cross
    "dry_run": true,                   // âš ï¸ æ¨¡æ‹Ÿæ¨¡å¼ï¼ˆä¸Šçº¿å‰å¿…é¡»æµ‹è¯•ï¼ï¼‰
    "dry_run_wallet": 1340             // æ¨¡æ‹Ÿèµ„é‡‘ï¼ˆUSDTï¼‰
}
```

**é…ç½®å»ºè®®**:
- æ–°æ‰‹å»ºè®® `max_open_trades: 2-3`ï¼Œé™ä½é£é™©
- `tradable_balance_ratio: 0.99` ä¿ç•™ 1% ä½œä¸ºäº¤æ˜“è´¹ç”¨ç¼“å†²
- **å¼ºçƒˆå»ºè®®å…ˆç”¨ `dry_run: true` æµ‹è¯•è‡³å°‘ä¸€å‘¨**
- `margin_mode: "isolated"` æ›´å®‰å…¨ï¼Œé¿å…è¿é”æ¸…ç®—

#### 2. **LLM é…ç½®**

```json
"llm_config": {
    "api_base": "http://host.docker.internal:3120",  // æœ¬åœ°APIç”¨host.docker.internal
    "api_key": "sk-xxx",                              // æ‚¨çš„APIå¯†é’¥
    "model": "qwen/qwen3-coder-30b",                 // æ¨¡å‹åç§°
    "embedding_model": "text-embedding-bge-m3"       // å‘é‡åŒ–æ¨¡å‹
}
```

**é…ç½®è¯´æ˜**:

| é…ç½®é¡¹ | è¯´æ˜ | æ¨èå€¼ |
|--------|------|--------|
| `api_base` | API æœåŠ¡åœ°å€ | æœ¬åœ°ï¼š`http://host.docker.internal:PORT`<br>è¿œç¨‹ï¼šå®Œæ•´ HTTPS URL |
| `api_key` | API å¯†é’¥ | ä»æ‚¨çš„ LLM æä¾›å•†è·å– |
| `model` | LLM æ¨¡å‹ | GPT-4ã€Qwen3ã€DeepSeek ç­‰ |
| `embedding_model` | å‘é‡åŒ–æ¨¡å‹ | `text-embedding-bge-m3` æˆ– OpenAI embeddings |

**æ”¯æŒçš„ LLM æä¾›å•†**:
- âœ… **OpenAI** (GPT-4, GPT-3.5-turbo)
- âœ… **æœ¬åœ°éƒ¨ç½²** (é€šè¿‡ LM Studioã€Ollama + OneAPI)
- âœ… **Qwen** (Qwen3-Coder-30B æ¨è)
- âœ… **DeepSeek** (DeepSeek-V2ã€DeepSeek-Coder)
- âœ… **ä»»ä½•å…¼å®¹ OpenAI API æ ¼å¼çš„æœåŠ¡**

**Docker ç½‘ç»œè¯´æ˜**:
```bash
# å®¹å™¨è®¿é—®å®¿ä¸»æœºæœåŠ¡ï¼ˆæœ¬åœ° APIï¼‰
api_base: "http://host.docker.internal:3120"

# å®¹å™¨è®¿é—®è¿œç¨‹æœåŠ¡
api_base: "https://api.openai.com/v1"
api_base: "https://api.deepseek.com/v1"
```

ğŸ’¡ **æ€§èƒ½ä¼˜åŒ–å»ºè®®**:
- ä½¿ç”¨ **30B+ å‚æ•°æ¨¡å‹**è·å¾—æ›´å¥½çš„å†³ç­–è´¨é‡
- æ¨è **Qwen3-Coder-30B** æˆ– **DeepSeek-Coder-V2**
- æœ¬åœ°éƒ¨ç½²å»ºè®®è‡³å°‘ **24GB VRAM** (æˆ–ä½¿ç”¨é‡åŒ–æ¨¡å‹)

#### 3. **RAG é…ç½®**

```json
"rag_config": {
    "enable": true,                    // æ˜¯å¦å¯ç”¨ RAGï¼ˆå»ºè®®å¼€å¯ï¼‰
    "vector_db": "chromadb",          // å‘é‡æ•°æ®åº“ç±»å‹
    "similarity_top_k": 5,            // æ£€ç´¢ç›¸ä¼¼æ¡ˆä¾‹æ•°é‡
    "min_similarity": 0.7,            // æœ€å°ç›¸ä¼¼åº¦é˜ˆå€¼ (0-1)
    "storage_path": "./user_data/data/vector_store",
    "max_history_size": 10000,        // æœ€å¤§å†å²è®°å½•æ•°
    "cleanup_days": 30                // è‡ªåŠ¨æ¸…ç†æ—§æ•°æ®ï¼ˆå¤©ï¼‰
}
```

**é…ç½®è¯´æ˜**:
- `enable: true` - å¯ç”¨ RAG è®© LLM ä»å†å²ç»éªŒå­¦ä¹ 
- `similarity_top_k: 5` - æ¯æ¬¡æ£€ç´¢ 5 ä¸ªæœ€ç›¸ä¼¼çš„å†å²æ¡ˆä¾‹
- `min_similarity: 0.7` - ç›¸ä¼¼åº¦é˜ˆå€¼ï¼ˆ0.7 = 70% ç›¸ä¼¼ï¼‰
- `max_history_size: 10000` - è¶…è¿‡æ­¤æ•°é‡ä¼šè‡ªåŠ¨æ¸…ç†æœ€æ—§çš„è®°å½•

ğŸ’¡ **æ€§èƒ½è°ƒä¼˜**:
```json
// å¦‚æœå†³ç­–é€Ÿåº¦æ…¢ï¼Œå¯ä»¥å‡å°‘æ£€ç´¢æ•°é‡
"similarity_top_k": 3,
"min_similarity": 0.75  // æé«˜é˜ˆå€¼ï¼Œåªæ£€ç´¢æ›´ç›¸ä¼¼çš„æ¡ˆä¾‹
```

#### 4. **é£é™©ç®¡ç†**

```json
"risk_management": {
    "max_leverage": 100,               // æœ€å¤§æ æ†å€æ•°ï¼ˆç¡¬é™åˆ¶ï¼‰
    "default_leverage": 10,            // é»˜è®¤æ æ†ï¼ˆLLMæœªæŒ‡å®šæ—¶ä½¿ç”¨ï¼‰
    "max_position_pct": 50,            // å•ä»“ä½æœ€å¤§èµ„é‡‘å æ¯” (%)
    "max_open_trades": 4,              // æœ€å¤§æŒä»“æ•°
    "allow_model_freedom": true,       // å…è®¸ LLM è‡ªç”±é€‰æ‹©æ æ†
    "emergency_stop_loss": -0.15       // ç´§æ€¥æ­¢æŸï¼šè´¦æˆ·äºæŸ15%æ—¶å…¨å¹³
}
```

**é£é™©é…ç½®å»ºè®®**:

| é£é™©åå¥½ | max_leverage | default_leverage | max_open_trades | emergency_stop_loss |
|---------|--------------|------------------|-----------------|---------------------|
| ğŸŸ¢ **ä¿å®ˆ** | 10 | 3 | 2 | -0.10 (10%) |
| ğŸŸ¡ **å¹³è¡¡** | 20 | 10 | 3-4 | -0.15 (15%) |
| ğŸ”´ **æ¿€è¿›** | 50 | 15 | 5-6 | -0.20 (20%) |

âš ï¸ **é‡è¦è¯´æ˜**:
- `allow_model_freedom: true` - LLM å¯ä»¥æ ¹æ®å¸‚åœºæƒ…å†µè‡ªç”±é€‰æ‹©æ æ†ï¼ˆ1x åˆ° max_leverageï¼‰
- `allow_model_freedom: false` - å§‹ç»ˆä½¿ç”¨ `default_leverage`ï¼Œæ›´ä¿å®ˆ
- `emergency_stop_loss` - å…¨å±€ä¿æŠ¤ï¼Œå½“è´¦æˆ·æ€»äºæŸè¾¾åˆ°æ­¤æ¯”ä¾‹æ—¶å¼ºåˆ¶å¹³æ‰æ‰€æœ‰ä»“ä½
- `max_position_pct: 50` - å•ç¬”äº¤æ˜“æœ€å¤šä½¿ç”¨ 50% çš„å¯ç”¨èµ„é‡‘

#### 5. **ç»éªŒé…ç½®**

```json
"experience_config": {
    "log_decisions": true,             // è®°å½•å†³ç­–æ—¥å¿—
    "log_trades": true,                // è®°å½•äº¤æ˜“æ—¥å¿—
    "decision_log_path": "./user_data/logs/llm_decisions.jsonl",
    "trade_log_path": "./user_data/logs/trade_experience.jsonl"
}
```

---

## ğŸ“– ä½¿ç”¨æŒ‡å—

### LLM å†³ç­–æµç¨‹

```mermaid
graph TD
    A[æ–°Kçº¿åˆ°æ¥] --> B[æ„å»ºå¸‚åœºä¸Šä¸‹æ–‡]
    B --> C[æŠ€æœ¯æŒ‡æ ‡åˆ†æ]
    B --> D[è´¦æˆ·çŠ¶æ€]
    B --> E[æŒä»“æƒ…å†µ]
    C --> F[RAGæ£€ç´¢ç›¸ä¼¼å†å²]
    D --> F
    E --> F
    F --> G[LLMåˆ†æå†³ç­–]
    G --> H{é€‰æ‹©Function}
    H -->|å¼€ä»“| I[signal_entry_long/short]
    H -->|å¹³ä»“| J[signal_exit]
    H -->|è°ƒæ•´| K[adjust_position]
    H -->|è§‚æœ›| L[signal_hold/wait]
    I --> M[æ‰§è¡Œäº¤æ˜“]
    J --> M
    K --> M
    L --> N[ç­‰å¾…ä¸‹ä¸€å‘¨æœŸ]
    M --> O[è®°å½•å†³ç­–å’Œç»“æœ]
    O --> P[æ›´æ–°RAGçŸ¥è¯†åº“]
```

### äº¤æ˜“å‡½æ•°è¯¦è§£

#### 1. **å¼€å¤šä»“ - signal_entry_long**

```python
signal_entry_long(
    pair="BTC/USDT:USDT",
    limit_price=95000.0,          # æŒ‚å•ä»·æ ¼ï¼ˆç•¥ä½äºå½“å‰ä»·ï¼‰
    leverage=10,                  # æ æ†å€æ•°
    stoploss_pct=-10,             # æ­¢æŸï¼šè´¦æˆ·äºæŸ10%
    confidence_score=85,          # ç½®ä¿¡åº¦ï¼š85/100
    key_support=94000.0,          # å…³é”®æ”¯æ’‘ä½
    key_resistance=96000.0,       # å…³é”®é˜»åŠ›ä½
    rsi_value=45,                 # å½“å‰RSI
    trend_strength="å¼ºåŠ¿",        # è¶‹åŠ¿å¼ºåº¦
    reason="ä»·æ ¼çªç ´EMA20ï¼ŒRSIè¶…å–åå¼¹ï¼Œæ—¥çº¿è¶‹åŠ¿å‘ä¸Š"
)
```

**æ•ˆæœ**:
- åœ¨ 95000 USDT æŒ‚é™ä»·å•åšå¤š BTC
- ä½¿ç”¨ 10x æ æ†
- å½“è´¦æˆ·äºæŸè¾¾åˆ° 10% æ—¶è‡ªåŠ¨æ­¢æŸ
- LLM å¯¹æ­¤å†³ç­–çš„ç½®ä¿¡åº¦ä¸º 85%

#### 2. **å¼€ç©ºä»“ - signal_entry_short**

```python
signal_entry_short(
    pair="ETH/USDT:USDT",
    limit_price=3500.0,           # æŒ‚å•ä»·æ ¼ï¼ˆç•¥é«˜äºå½“å‰ä»·ï¼‰
    leverage=15,
    stoploss_pct=-8,              # æ­¢æŸï¼šè´¦æˆ·äºæŸ8%
    confidence_score=75,
    key_support=3400.0,
    key_resistance=3550.0,
    rsi_value=72,                 # RSIè¶…ä¹°
    trend_strength="ä¸­ç­‰",
    reason="RSIè¶…ä¹°ï¼Œä»·æ ¼æ¥è¿‘é˜»åŠ›ä½ï¼ŒMACDæ­»å‰"
)
```

#### 3. **å¹³ä»“ - signal_exit**

```python
signal_exit(
    pair="BTC/USDT:USDT",
    limit_price=96500.0,          # æœŸæœ›å‡ºåœºä»·æ ¼
    confidence_score=90,
    rsi_value=78,
    reason="è¾¾åˆ°ç›®æ ‡åˆ©æ¶¦ï¼ŒRSIè¶…ä¹°ï¼Œè¶‹åŠ¿å‡å¼±"
)
```

#### 4. **åŠ ä»“ - adjust_position**

```python
adjust_position(
    pair="BTC/USDT:USDT",
    adjustment_pct=50,            # åŠ ä»“50%
    limit_price=94500.0,
    confidence_score=80,
    key_support=94000.0,
    key_resistance=96000.0,
    reason="ä»·æ ¼å›è°ƒè‡³æ”¯æ’‘ä½ï¼Œè¶‹åŠ¿ä¾ç„¶å‘ä¸Š"
)
```

**æ•ˆæœ**: åœ¨åŸæœ‰ä»“ä½åŸºç¡€ä¸Šå¢åŠ  50% çš„ä»“ä½

#### 5. **å‡ä»“ - adjust_position**

```python
adjust_position(
    pair="ETH/USDT:USDT",
    adjustment_pct=-30,           # å‡ä»“30%ï¼ˆè´Ÿæ•°ï¼‰
    limit_price=3480.0,
    confidence_score=70,
    key_support=3400.0,
    key_resistance=3500.0,
    reason="è·åˆ©éƒ¨åˆ†ç¦»åœºï¼Œé™ä½é£é™©"
)
```

### æ­¢æŸæœºåˆ¶è¯¦è§£

ç­–ç•¥ä½¿ç”¨ **è´¦æˆ·ç™¾åˆ†æ¯”æ­¢æŸ**ï¼Œè€Œéä»·æ ¼ç™¾åˆ†æ¯”ï¼š

```python
# ç¤ºä¾‹ï¼š10xæ æ†åšå¤šBTCï¼Œæ­¢æŸè®¾ç½®ä¸º -10%

å¼€ä»“ä»·: 95000 USDT
æ æ†: 10x
è´¦æˆ·æ­¢æŸ: -10%

# è®¡ç®—è§¦å‘ä»·æ ¼:
ä»·æ ¼éœ€è¦ä¸‹è·Œ 1% æ‰ä¼šè§¦å‘æ­¢æŸï¼ˆå› ä¸º10xæ æ†ï¼‰
æ­¢æŸä»· = 95000 * (1 - 10% / 10) = 94050 USDT
```

**ä¼˜åŠ¿**:
- æ— è®ºæ æ†å¤šå°‘ï¼Œè´¦æˆ·é£é™©å›ºå®š
- LLM å¯ä»¥è‡ªç”±è°ƒæ•´æ æ†ï¼Œæ­¢æŸä¿æŠ¤å§‹ç»ˆæœ‰æ•ˆ
- ç¬¦åˆèµ„é‡‘ç®¡ç†åŸåˆ™

---

## ğŸ”§ æ•…éšœæ’é™¤

### â“ å¸¸è§é—®é¢˜ FAQ

#### Q1: å¦‚ä½•ç¡®è®¤ LLM API æ˜¯å¦æ­£å¸¸è¿æ¥ï¼Ÿ

```bash
# ä»å®¹å™¨å†…æµ‹è¯•
docker exec freqtrade-llm curl http://host.docker.internal:3120/v1/models

# ä»å®¿ä¸»æœºæµ‹è¯•
curl http://localhost:3120/v1/models
```

#### Q2: å¦‚ä½•æŸ¥çœ‹ LLM çš„å†³ç­–ç†ç”±ï¼Ÿ

```bash
# æŸ¥çœ‹æ ¼å¼åŒ–çš„å†³ç­–æ—¥å¿—
tail -f user_data/logs/llm_decisions.jsonl | jq '{
  æ—¶é—´: .timestamp,
  äº¤æ˜“å¯¹: .pair,
  å†³ç­–: .action,
  ç½®ä¿¡åº¦: .confidence,
  ç†ç”±: .reason
}'
```

#### Q3: ç³»ç»Ÿä¸äº¤æ˜“ï¼Œä¸€ç›´è§‚æœ›ï¼Ÿ

**å¯èƒ½åŸå› **:
1. LLM é£æ ¼è¿‡äºä¿å®ˆ - å¸‚åœºæ³¢åŠ¨å°æ—¶ä¼šé€‰æ‹©è§‚æœ›
2. RAG æ£€ç´¢åˆ°è¿‡å¤šå¤±è´¥æ¡ˆä¾‹ - å¯¼è‡´ LLM è°¨æ…
3. æŠ€æœ¯æŒ‡æ ‡ä¸æ»¡è¶³å…¥åœºæ¡ä»¶

**è§£å†³æ–¹æ³•**:
```json
// æ–¹æ³•1ï¼šè°ƒæ•´ LLM temperatureï¼ˆåœ¨ llm_client.py ä¸­ï¼‰
"temperature": 0.8  // å¢åŠ åˆ›é€ æ€§

// æ–¹æ³•2ï¼šæ¸…ç† RAG æ•°æ®ï¼Œé‡æ–°å­¦ä¹ 
./manage.sh clean
./manage.sh start
```

#### Q4: å¦‚ä½•ä»æ¨¡æ‹Ÿäº¤æ˜“åˆ‡æ¢åˆ°å®ç›˜ï¼Ÿ

```bash
# 1. åœæ­¢æœåŠ¡
./manage.sh stop

# 2. å¤‡ä»½æ¨¡æ‹Ÿæ•°æ®ï¼ˆå¯é€‰ï¼‰
cp -r user_data/data user_data/data_backup_dry_run

# 3. ä¿®æ”¹é…ç½®
nano user_data/config.json
# è®¾ç½® "dry_run": false
# å¡«å†™çœŸå®äº¤æ˜“æ‰€ API å¯†é’¥

# 4. æ¸…ç†æ¨¡æ‹Ÿäº¤æ˜“æ•°æ®
rm -f user_data/tradesv3.sqlite*

# 5. é‡æ–°å¯åŠ¨
./manage.sh start

# 6. å¯†åˆ‡ç›‘æ§å‰å‡ ç¬”äº¤æ˜“
./manage.sh logs
```

#### Q5: å¦‚ä½•å¤‡ä»½å’Œæ¢å¤æ•°æ®ï¼Ÿ

```bash
# å¤‡ä»½ï¼ˆåŒ…æ‹¬ RAG å‘é‡åº“å’Œäº¤æ˜“æ•°æ®ï¼‰
tar -czf backup_$(date +%Y%m%d).tar.gz user_data/data user_data/logs user_data/*.sqlite*

# æ¢å¤
tar -xzf backup_20241106.tar.gz
./manage.sh restart
```

#### Q6: LLM å†³ç­–è´¨é‡ä¸å¥½æ€ä¹ˆåŠï¼Ÿ

**ä¼˜åŒ–æ–¹å‘**:
1. **æ›´æ¢æ›´å¼ºçš„æ¨¡å‹** - ä½¿ç”¨ GPT-4 æˆ– Qwen3-Coder-30B
2. **è°ƒæ•´ System Prompt** - ä¿®æ”¹ç­–ç•¥æ–‡ä»¶ä¸­çš„ Prompt
3. **ç§¯ç´¯æ›´å¤šæ•°æ®** - RAG éœ€è¦æ—¶é—´å­¦ä¹ 
4. **è°ƒæ•´é£é™©å‚æ•°** - é™ä½ `allow_model_freedom`ï¼Œä½¿ç”¨å›ºå®šæ æ†

---

### ğŸ› å…·ä½“é”™è¯¯å¤„ç†

#### 1. **å®¹å™¨å¯åŠ¨å¤±è´¥**

```bash
# æ£€æŸ¥Dockeræ˜¯å¦è¿è¡Œ
docker info

# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
docker-compose logs
```

#### 2. **LLM API è¿æ¥å¤±è´¥**

**é”™è¯¯**: `Connection refused` æˆ– `Timeout`

**è§£å†³**:
```bash
# æ£€æŸ¥ API åœ°å€
curl http://host.docker.internal:3120/v1/models

# å¦‚æœæ˜¯æœ¬åœ°APIï¼Œç¡®ä¿ä½¿ç”¨ host.docker.internal
# å¦‚æœæ˜¯è¿œç¨‹APIï¼Œä½¿ç”¨å®Œæ•´URL
```

#### 3. **ChromaDB åˆå§‹åŒ–å¤±è´¥**

**é”™è¯¯**: `chromadb module not found`

**è§£å†³**:
```bash
# é‡æ–°æ„å»ºé•œåƒ
./manage.sh deploy
```

#### 4. **RAG æ£€ç´¢ç¼“æ…¢**

**ä¼˜åŒ–**:
```json
"rag_config": {
    "similarity_top_k": 3,        // å‡å°‘æ£€ç´¢æ•°é‡
    "min_similarity": 0.75,       // æé«˜ç›¸ä¼¼åº¦é˜ˆå€¼
    "max_history_size": 5000      // å‡å°‘å†å²è®°å½•
}
```

#### 5. **LLM å†³ç­–è¶…æ—¶**

**é”™è¯¯**: `LLM timeout after 60s`

**è§£å†³**:
```json
"llm_config": {
    "timeout": 120,               // å¢åŠ è¶…æ—¶æ—¶é—´
    "max_tokens": 1500            // å‡å°‘è¾“å‡ºé•¿åº¦
}
```

#### 6. **æ¸…ç†æ‰€æœ‰æ•°æ®é‡æ–°å¼€å§‹**

```bash
./manage.sh clean
```

**æ³¨æ„**: è¿™ä¼šåˆ é™¤ï¼š
- ChromaDB å‘é‡æ•°æ®åº“
- äº¤æ˜“æ•°æ®åº“
- æ‰€æœ‰æ—¥å¿—æ–‡ä»¶

---

## ğŸ”¬ æŠ€æœ¯ç»†èŠ‚

### LLM Function Calling å·¥ä½œåŸç†

1. **ä¸Šä¸‹æ–‡æ„å»º**: æ”¶é›†å¸‚åœºæ•°æ®ã€æŠ€æœ¯æŒ‡æ ‡ã€è´¦æˆ·çŠ¶æ€
2. **RAG æ£€ç´¢**: ä»å‘é‡æ•°æ®åº“æ£€ç´¢ç›¸ä¼¼çš„å†å²æƒ…å†µ
3. **LLM æ¨ç†**: ç»¼åˆåˆ†æå½“å‰æƒ…å†µï¼Œå†³å®šä½¿ç”¨å“ªä¸ªå‡½æ•°
4. **Function Call**: LLM è¿”å›å‡½æ•°åå’Œå‚æ•°
5. **æ‰§è¡Œå‡½æ•°**: FunctionExecutor æ‰§è¡Œäº¤æ˜“å‡½æ•°
6. **ç»“æœåé¦ˆ**: å°†æ‰§è¡Œç»“æœåé¦ˆç»™ LLMï¼ˆå¦‚æœ‰éœ€è¦ï¼‰
7. **ç»éªŒè®°å½•**: è®°å½•å†³ç­–å’Œç»“æœåˆ° RAG ç³»ç»Ÿ

### å¤šæ—¶é—´æ¡†æ¶æ•´åˆ

ç­–ç•¥ä½¿ç”¨ `@informative` è£…é¥°å™¨å®ç°å¤šæ—¶é—´æ¡†æ¶ï¼š

```python
@informative('1h')
def populate_indicators_1h(self, dataframe, metadata):
    # 1å°æ—¶æŒ‡æ ‡
    dataframe['ema_20'] = ta.EMA(dataframe, timeperiod=20)
    return dataframe
```

åœ¨å†³ç­–æ—¶ï¼ŒLLM å¯ä»¥åŒæ—¶çœ‹åˆ°ï¼š
- 15åˆ†é’Ÿï¼šçŸ­æœŸè¶‹åŠ¿
- 1å°æ—¶ï¼šä¸­æœŸè¶‹åŠ¿
- 4å°æ—¶ï¼šä¸»è¦è¶‹åŠ¿
- æ—¥çº¿ï¼šé•¿æœŸè¶‹åŠ¿

### ä¸Šä¸‹æ–‡Tokenç®¡ç†

```json
"context_config": {
    "max_context_tokens": 6000,       // æ€»Tokené™åˆ¶
    "system_prompt_tokens": 500,      // ç³»ç»Ÿæç¤ºè¯
    "market_data_tokens": 800,        // å¸‚åœºæ•°æ®
    "rag_history_tokens": 1500,       // RAGå†å²
    "enable_context_compression": true
}
```

ä¸Šä¸‹æ–‡ä¼˜å…ˆçº§ï¼š
1. **ç³»ç»Ÿæç¤ºè¯**ï¼ˆå¿…éœ€ï¼‰
2. **å½“å‰å¸‚åœºæ•°æ®**ï¼ˆå¿…éœ€ï¼‰
3. **è´¦æˆ·å’ŒæŒä»“ä¿¡æ¯**ï¼ˆå¿…éœ€ï¼‰
4. **RAG å†å²æ¡ˆä¾‹**ï¼ˆå¯é€‰ï¼‰

---

## ğŸ“Š æ€§èƒ½ç›‘æ§

### æŸ¥çœ‹å®æ—¶æ—¥å¿—

```bash
# ä¸»æ—¥å¿—
tail -f user_data/logs/freqtrade.log

# LLMå†³ç­–æ—¥å¿—
tail -f user_data/logs/llm_decisions.jsonl

# äº¤æ˜“ç»éªŒæ—¥å¿—
tail -f user_data/logs/trade_experience.jsonl
```

### Web UI

è®¿é—® http://localhost:8086ï¼š

- ğŸ“ˆ å®æ—¶æŒä»“å’Œæ”¶ç›Š
- ğŸ“Š äº¤æ˜“å†å²
- ğŸ’¹ æ€§èƒ½ç»Ÿè®¡
- ğŸ”” é€šçŸ¥ç®¡ç†

### Telegram Bot

é…ç½® Telegram é€šçŸ¥ï¼š

```json
"telegram": {
    "enabled": true,
    "token": "your-bot-token",
    "chat_id": "your-chat-id"
}
```

å‘½ä»¤åˆ—è¡¨ï¼š
- `/status` - æŸ¥çœ‹å½“å‰çŠ¶æ€
- `/profit` - æŸ¥çœ‹æ”¶ç›Š
- `/balance` - æŸ¥çœ‹ä½™é¢
- `/daily` - æ¯æ—¥ç»Ÿè®¡
- `/whitelist` - äº¤æ˜“å¯¹åˆ—è¡¨

---

## âš ï¸ é£é™©æç¤º

1. **åŠ å¯†è´§å¸äº¤æ˜“å­˜åœ¨é«˜é£é™©**ï¼Œå¯èƒ½å¯¼è‡´æœ¬é‡‘æŸå¤±
2. **LLM å†³ç­–ä¸ä¿è¯ç›ˆåˆ©**ï¼Œéœ€è¦æŒç»­ç›‘æ§å’Œä¼˜åŒ–
3. **å»ºè®®å…ˆä½¿ç”¨æ¨¡æ‹Ÿäº¤æ˜“**ï¼ˆ`dry_run: true`ï¼‰æµ‹è¯•
4. **åˆç†è®¾ç½®æ­¢æŸå’Œä»“ä½**ï¼Œæ§åˆ¶å•ç¬”é£é™©
5. **å®šæœŸæ£€æŸ¥æ—¥å¿—**ï¼Œç¡®ä¿ç­–ç•¥æ­£å¸¸è¿è¡Œ
6. **é«˜æ æ†æœ‰çˆ†ä»“é£é™©**ï¼Œè°¨æ…ä½¿ç”¨
7. **ä¸è¦æŠ•å…¥è¶…è¿‡ä½ èƒ½æ‰¿å—æŸå¤±çš„èµ„é‡‘**

---

## ğŸ’ æœ€ä½³å®è·µ

### ğŸ¯ æ–°æ‰‹å…¥é—¨å»ºè®®

1. **ç¬¬ä¸€å‘¨ï¼šæ¨¡æ‹Ÿäº¤æ˜“è§‚å¯Ÿ**

   ```bash
   # ä½¿ç”¨é»˜è®¤é…ç½®ï¼Œdry_run: true
   ./manage.sh start
   # æ¯å¤©æŸ¥çœ‹å†³ç­–æ—¥å¿—ï¼Œäº†è§£ LLM çš„æ€è€ƒæ–¹å¼
   ```

2. **ç¬¬äºŒå‘¨ï¼šè°ƒæ•´å‚æ•°æµ‹è¯•**

   ```json
   // å°è¯•ä¸åŒçš„é£é™©é…ç½®
   "max_open_trades": 2,
   "max_leverage": 10,
   "allow_model_freedom": false  // å›ºå®šæ æ†æ›´ç¨³å®š
   ```

3. **ç¬¬ä¸‰å‘¨ï¼šå°èµ„é‡‘å®ç›˜**

   ```bash
   # ä½¿ç”¨å°é¢èµ„é‡‘ï¼ˆå¦‚ 100 USDTï¼‰
   # è§‚å¯ŸçœŸå®ç¯å¢ƒä¸‹çš„è¡¨ç°
   ```

4. **ä¸€ä¸ªæœˆåï¼šæ ¹æ®æ•°æ®ä¼˜åŒ–**

   ```bash
   # åˆ†æå†å²äº¤æ˜“
   # æ ¹æ®èƒœç‡ã€ç›ˆäºæ¯”è°ƒæ•´é…ç½®
   ```

### ğŸ”§ æ€§èƒ½ä¼˜åŒ–å»ºè®®

#### 1. **é™ä½å»¶è¿Ÿ**

```json
"rag_config": {
    "similarity_top_k": 3,  // å‡å°‘æ£€ç´¢æ•°é‡
    "enable": false          // åˆæœŸå¯ä»¥å…³é—­ RAG
}
```

#### 2. **æå‡å†³ç­–è´¨é‡**

- ä½¿ç”¨æ›´å¼ºçš„æ¨¡å‹ï¼ˆGPT-4ã€Claudeã€Qwen3-30Bï¼‰
- ç§¯ç´¯æ›´å¤šå†å²æ•°æ®è®© RAG å­¦ä¹ 
- è°ƒæ•´ System Prompt æ›´ç¬¦åˆä½ çš„äº¤æ˜“é£æ ¼

#### 3. **èµ„é‡‘ç®¡ç†**

```json
// ä¿å®ˆå‹é…ç½®
{
    "max_open_trades": 2,
    "tradable_balance_ratio": 0.90,  // åªç”¨90%èµ„é‡‘
    "max_leverage": 5,
    "emergency_stop_loss": -0.10
}
```

### ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

#### æ¯æ—¥æ£€æŸ¥æ¸…å•

- [ ] æŸ¥çœ‹æ—¥å¿—ç¡®è®¤ç³»ç»Ÿè¿è¡Œæ­£å¸¸
- [ ] æ£€æŸ¥ Web UI çš„æŒä»“å’Œæ”¶ç›Š
- [ ] æŸ¥çœ‹ LLM å†³ç­–æ—¥å¿—ï¼Œäº†è§£æ¨ç†è¿‡ç¨‹
- [ ] ç¡®è®¤äº¤æ˜“æ‰€ API è¿æ¥æ­£å¸¸

#### æ¯å‘¨ç»´æŠ¤

- [ ] å¤‡ä»½æ•°æ®ï¼ˆRAG å‘é‡åº“ + äº¤æ˜“æ•°æ®åº“ï¼‰
- [ ] æ£€æŸ¥ Docker æ—¥å¿—æ˜¯å¦æœ‰å¼‚å¸¸
- [ ] è¯„ä¼°ç­–ç•¥è¡¨ç°ï¼Œå¿…è¦æ—¶è°ƒæ•´å‚æ•°
- [ ] æ£€æŸ¥ ChromaDB å­˜å‚¨ç©ºé—´

#### æ¯æœˆä¼˜åŒ–

- [ ] åˆ†æå†å²äº¤æ˜“æ•°æ®
- [ ] ä¼˜åŒ–é£é™©å‚æ•°
- [ ] è€ƒè™‘æ›´æ–° Freqtrade ç‰ˆæœ¬
- [ ] è¯„ä¼°æ˜¯å¦éœ€è¦æ›´æ¢ LLM æ¨¡å‹

### ğŸ“ è¿›é˜¶ç©æ³•

#### 1. **å¤šç­–ç•¥å¹¶è¡Œ**

å¯ä»¥è¿è¡Œå¤šä¸ªå®ä¾‹ï¼Œä½¿ç”¨ä¸åŒçš„é…ç½®ï¼š

```bash
# ä¿å®ˆç­–ç•¥å®ä¾‹
cp -r ft-userdata-llm ft-userdata-llm-conservative
# ä¿®æ”¹é…ç½®å’Œå®¹å™¨å

# æ¿€è¿›ç­–ç•¥å®ä¾‹
cp -r ft-userdata-llm ft-userdata-llm-aggressive
# ä¿®æ”¹é…ç½®å’Œå®¹å™¨å
```

#### 2. **è‡ªå®šä¹‰ System Prompt**

ä¿®æ”¹ `user_data/strategies/LLMFunctionStrategy.py` ä¸­çš„ Promptï¼Œè®© LLM æ›´ç¬¦åˆä½ çš„äº¤æ˜“é£æ ¼ã€‚

#### 3. **é›†æˆè‡ªå®šä¹‰æŒ‡æ ‡**

åœ¨ç­–ç•¥æ–‡ä»¶ä¸­æ·»åŠ è‡ªå·±çš„æŠ€æœ¯æŒ‡æ ‡ï¼ŒLLM ä¼šåœ¨å†³ç­–æ—¶è€ƒè™‘è¿™äº›æŒ‡æ ‡ã€‚

#### 4. **Webhook é€šçŸ¥**

é…ç½® Discord/Telegramï¼Œå®æ—¶æ¥æ”¶äº¤æ˜“é€šçŸ¥ã€‚

---

## ğŸ“„ è®¸å¯è¯

MIT License

---

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

---

## ğŸ“ æ”¯æŒ

- **GitHub Issues**: æŠ¥å‘Šé—®é¢˜
- **æ–‡æ¡£**: æŸ¥çœ‹ Freqtrade å®˜æ–¹æ–‡æ¡£
- **ç¤¾åŒº**: åŠ å…¥ Freqtrade Discord/Telegram

---

## ğŸ“ å­¦ä¹ èµ„æº

- [Freqtrade å®˜æ–¹æ–‡æ¡£](https://www.freqtrade.io/)
- [OpenAI Function Calling](https://platform.openai.com/docs/guides/function-calling)
- [RAG æŠ€æœ¯åŸç†](https://www.pinecone.io/learn/retrieval-augmented-generation/)
- [åŠ å¯†è´§å¸äº¤æ˜“åŸºç¡€](https://academy.binance.com/)

---

ç¥äº¤æ˜“é¡ºåˆ©ï¼ğŸš€
